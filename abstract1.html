<!DOCTYPE html>
  <html lang="en">
  <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Abstract Evaluation - Pair 1</title>
      <script src="https://webgazer.cs.brown.edu/webgazer.js"></script>
      <style>
          body {
              font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
              max-width: 900px;
              margin: 0 auto;
              padding: 20px;
              line-height: 1.6;
              background-color: #f8f9fa;
              color: #333;
          }
          .survey-container {
              background-color: white;
              padding: 40px;
              border-radius: 12px;
              box-shadow: 0 4px 20px rgba(0,0,0,0.1);
          }
          .header {
              text-align: center;
              margin-bottom: 40px;
              padding-bottom: 20px;
              border-bottom: 2px solid #e9ecef;
          }
          .header h1 {
              color: #2c3e50;
              margin-bottom: 10px;
              font-size: 28px;
          }
          .progress-indicator {
              text-align: center;
              margin-bottom: 30px;
              padding: 15px;
              background-color: #e7f3ff;
              border-radius: 8px;
          }
          .section-title {
              font-size: 20px;
              font-weight: bold;
              color: #2c3e50;
              margin: 30px 0 20px 0;
              padding-bottom: 10px;
              border-bottom: 1px solid #dee2e6;
          }
          .question-block {
              margin-bottom: 25px;
              padding: 20px;
              border-left: 4px solid #007bff;
              background-color: #f8f9fa;
              border-radius: 8px;
          }
          .question-title {
              font-weight: 600;
              margin-bottom: 15px;
              color: #2c3e50;
              font-size: 16px;
          }
          .abstract-display {
              display: flex;
              gap: 25px;
              margin: 25px 0;
          }
          .abstract-box {
              flex: 1;
              padding: 20px;
              border: 2px solid #dee2e6;
              border-radius: 8px;
              background-color: white;
              box-shadow: 0 2px 8px rgba(0,0,0,0.05);
              position: relative;
          }
          .abstract-box.tracking {
              border-color: #007bff;
              box-shadow: 0 0 10px rgba(0,123,255,0.3);
          }
          .abstract-title {
              font-weight: bold;
              margin-bottom: 15px;
              color: #007bff;
              font-size: 18px;
              text-align: center;
          }
          .abstract-text {
              line-height: 1.8;
              font-size: 16px;
              color: #495057;
              text-align: justify;
          }
          .likert-scale {
              display: flex;
              justify-content: space-between;
              margin: 15px 0;
              gap: 5px;
          }
          .likert-option {
              display: flex;
              flex-direction: column;
              align-items: center;
              flex: 1;
              padding: 8px;
              border-radius: 6px;
              transition: background-color 0.2s;
          }
          .likert-option:hover {
              background-color: #f8f9fa;
          }
          .likert-option input[type="radio"] {
              margin-bottom: 8px;
              transform: scale(1.2);
          }
          .likert-option label {
              font-size: 11px;
              text-align: center;
              color: #6c757d;
              cursor: pointer;
              font-weight: 500;
          }
          .continue-btn {
              background: linear-gradient(135deg, #007bff, #0056b3);
              color: white;
              padding: 15px 40px;
              border: none;
              border-radius: 8px;
              font-size: 18px;
              font-weight: 600;
              cursor: pointer;
              margin-top: 30px;
              transition: transform 0.2s, box-shadow 0.2s;
              display: block;
              margin-left: auto;
              margin-right: auto;
          }
          .continue-btn:hover {
              transform: translateY(-2px);
              box-shadow: 0 6px 20px rgba(0,123,255,0.3);
          }
          .required-indicator {
              color: #dc3545;
              font-weight: bold;
          }
          .reading-timer {
              position: fixed;
              top: 20px;
              left: 20px;
              background-color: rgba(0, 123, 255, 0.9);
              color: white;
              padding: 10px 15px;
              border-radius: 8px;
              font-weight: bold;
              z-index: 1000;
          }
          #webgazerVideoFeed {
              position: fixed;
              top: 20px;
              right: 20px;
              width: 150px;
              height: 112px;
              border: 2px solid #007bff;
              border-radius: 8px;
              z-index: 1000;
          }
          .gaze-dot {
              position: fixed;
              width: 10px;
              height: 10px;
              border-radius: 50%;
              background-color: rgba(255, 0, 0, 0.7);
              pointer-events: none;
              z-index: 999;
              display: none;
          }
          @media (max-width: 768px) {
              .abstract-display {
                  flex-direction: column;
              }
          }
      </style>
  </head>
  <body>
      <div class="reading-timer" id="readingTimer">Reading Time: 0:00</div>
      <div class="gaze-dot" id="gazeDot"></div>

      <div class="survey-container">
          <div class="header">
              <h1>Abstract Evaluation - Pair 1</h1>
          </div>

          <div class="progress-indicator">
              <strong>Step 2 of 4:</strong> Abstract Pair 1 | Eye tracking is active
          </div>

          <div class="section-title">ðŸ“„ Abstract Comparison</div>
          <p style="color: #6c757d; margin-bottom: 25px;">Please read both abstracts carefully. Take your time to understand the content. Your eye movements are being tracked to understand reading patterns.</p>

          <div class="question-block">
              <div class="abstract-display">
                  <div class="abstract-box" id="abstractA">
                      <div class="abstract-title">Abstract A</div>
                      <div class="abstract-text">This investigation sustains that consciousness underlies moral agency in decision-making processes. The research enables autonomous choice through mediating pathways that serve as the cornerstone of ethical reasoning frameworks. Statistical analysis reveals significant predictors that translate into measurable behavioral outcomes across diverse populations.</div>
                  </div>
                  <div class="abstract-box" id="abstractB">
                      <div class="abstract-title">Abstract B</div>
                      <div class="abstract-text">This investigation shows that consciousness relates to moral agency in decision-making processes. The research allows autonomous choice through pathways that act as important elements of ethical reasoning frameworks. Statistical analysis shows factors that lead to measurable behavioral outcomes across diverse populations.</div>
                  </div>
              </div>
          </div>

          <form id="abstract1Form" onsubmit="handleAbstract1(event)">
              <div class="question-block">
                  <div class="question-title">How clear is Abstract A? <span class="required-indicator">*</span></div>
                  <div class="likert-scale">
                      <div class="likert-option">
                          <input type="radio" id="pair1_clarity_a_1" name="pair1_clarity_a" value="1" required>
                          <label for="pair1_clarity_a_1">Very unclear</label>
                      </div>
                      <div class="likert-option">
                          <input type="radio" id="pair1_clarity_a_2" name="pair1_clarity_a" value="2">
                          <label for="pair1_clarity_a_2">Unclear</label>
                      </div>
                      <div class="likert-option">
                          <input type="radio" id="pair1_clarity_a_3" name="pair1_clarity_a" value="3">
                          <label for="pair1_clarity_a_3">Neutral</label>
                      </div>
                      <div class="likert-option">
                          <input type="radio" id="pair1_clarity_a_4" name="pair1_clarity_a" value="4">
                          <label for="pair1_clarity_a_4">Clear</label>
                      </div>
                      <div class="likert-option">
                          <input type="radio" id="pair1_clarity_a_5" name="pair1_clarity_a" value="5">
                          <label for="pair1_clarity_a_5">Very clear</label>
                      </div>
                  </div>
              </div>

              <div class="question-block">
                  <div class="question-title">How clear is Abstract B? <span class="required-indicator">*</span></div>
                  <div class="likert-scale">
                      <div class="likert-option">
                          <input type="radio" id="pair1_clarity_b_1" name="pair1_clarity_b" value="1" required>
                          <label for="pair1_clarity_b_1">Very unclear</label>
                      </div>
                      <div class="likert-option">
                          <input type="radio" id="pair1_clarity_b_2" name="pair1_clarity_b" value="2">
                          <label for="pair1_clarity_b_2">Unclear</label>
                      </div>
                      <div class="likert-option">
                          <input type="radio" id="pair1_clarity_b_3" name="pair1_clarity_b" value="3">
                          <label for="pair1_clarity_b_3">Neutral</label>
                      </div>
                      <div class="likert-option">
                          <input type="radio" id="pair1_clarity_b_4" name="pair1_clarity_b" value="4">
                          <label for="pair1_clarity_b_4">Clear</label>
                      </div>
                      <div class="likert-option">
                          <input type="radio" id="pair1_clarity_b_5" name="pair1_clarity_b" value="5">
                          <label for="pair1_clarity_b_5">Very clear</label>
                      </div>
                  </div>
              </div>

              <div class="question-block">
                  <div class="question-title">How convincing are the causal relationships described in Abstract A? <span class="required-indicator">*</span></div>
                  <div class="likert-scale">
                      <div class="likert-option">
                          <input type="radio" id="pair1_causal_a_1" name="pair1_causal_a" value="1" required>
                          <label for="pair1_causal_a_1">Not convincing</label>
                      </div>
                      <div class="likert-option">
                          <input type="radio" id="pair1_causal_a_2" name="pair1_causal_a" value="2">
                          <label for="pair1_causal_a_2">Slightly convincing</label>
                      </div>
                      <div class="likert-option">
                          <input type="radio" id="pair1_causal_a_3" name="pair1_causal_a" value="3">
                          <label for="pair1_causal_a_3">Moderately convincing</label>
                      </div>
                      <div class="likert-option">
                          <input type="radio" id="pair1_causal_a_4" name="pair1_causal_a" value="4">
                          <label for="pair1_causal_a_4">Very convincing</label>
                      </div>
                      <div class="likert-option">
                          <input type="radio" id="pair1_causal_a_5" name="pair1_causal_a" value="5">
                          <label for="pair1_causal_a_5">Extremely convincing</label>
                      </div>
                  </div>
              </div>

              <div class="question-block">
                  <div class="question-title">How convincing are the causal relationships described in Abstract B? <span class="required-indicator">*</span></div>
                  <div class="likert-scale">
                      <div class="likert-option">
                          <input type="radio" id="pair1_causal_b_1" name="pair1_causal_b" value="1" required>
                          <label for="pair1_causal_b_1">Not convincing</label>
                      </div>
                      <div class="likert-option">
                          <input type="radio" id="pair1_causal_b_2" name="pair1_causal_b" value="2">
                          <label for="pair1_causal_b_2">Slightly convincing</label>
                      </div>
                      <div class="likert-option">
                          <input type="radio" id="pair1_causal_b_3" name="pair1_causal_b" value="3">
                          <label for="pair1_causal_b_3">Moderately convincing</label>
                      </div>
                      <div class="likert-option">
                          <input type="radio" id="pair1_causal_b_4" name="pair1_causal_b" value="4">
                          <label for="pair1_causal_b_4">Very convincing</label>
                      </div>
                      <div class="likert-option">
                          <input type="radio" id="pair1_causal_b_5" name="pair1_causal_b" value="5">
                          <label for="pair1_causal_b_5">Extremely convincing</label>
                      </div>
                  </div>
              </div>

              <div class="question-block">
                  <div class="question-title">How confident do you feel about the research claims in Abstract A? <span class="required-indicator">*</span></div>
                  <div class="likert-scale">
                      <div class="likert-option">
                          <input type="radio" id="pair1_confidence_a_1" name="pair1_confidence_a" value="1" required>
                          <label for="pair1_confidence_a_1">Not confident</label>
                      </div>
                      <div class="likert-option">
                          <input type="radio" id="pair1_confidence_a_2" name="pair1_confidence_a" value="2">
                          <label for="pair1_confidence_a_2">Slightly confident</label>
                      </div>
                      <div class="likert-option">
                          <input type="radio" id="pair1_confidence_a_3" name="pair1_confidence_a" value="3">
                          <label for="pair1_confidence_a_3">Moderately confident</label>
                      </div>
                      <div class="likert-option">
                          <input type="radio" id="pair1_confidence_a_4" name="pair1_confidence_a" value="4">
                          <label for="pair1_confidence_a_4">Very confident</label>
                      </div>
                      <div class="likert-option">
                          <input type="radio" id="pair1_confidence_a_5" name="pair1_confidence_a" value="5">
                          <label for="pair1_confidence_a_5">Extremely confident</label>
                      </div>
                  </div>
              </div>

              <div class="question-block">
                  <div class="question-title">How confident do you feel about the research claims in Abstract B? <span class="required-indicator">*</span></div>
                  <div class="likert-scale">
                      <div class="likert-option">
                          <input type="radio" id="pair1_confidence_b_1" name="pair1_confidence_b" value="1" required>
                          <label for="pair1_confidence_b_1">Not confident</label>
                      </div>
                      <div class="likert-option">
                          <input type="radio" id="pair1_confidence_b_2" name="pair1_confidence_b" value="2">
                          <label for="pair1_confidence_b_2">Slightly confident</label>
                      </div>
                      <div class="likert-option">
                          <input type="radio" id="pair1_confidence_b_3" name="pair1_confidence_b" value="3">
                          <label for="pair1_confidence_b_3">Moderately confident</label>
                      </div>
                      <div class="likert-option">
                          <input type="radio" id="pair1_confidence_b_4" name="pair1_confidence_b" value="4">
                          <label for="pair1_confidence_b_4">Very confident</label>
                      </div>
                      <div class="likert-option">
                          <input type="radio" id="pair1_confidence_b_5" name="pair1_confidence_b" value="5">
                          <label for="pair1_confidence_b_5">Extremely confident</label>
                      </div>
                  </div>
              </div>

              <button type="submit" class="continue-btn">Continue to Abstract Pair 2</button>
          </form>
      </div>

      <script>
          let startTime;
          let gazeData = [];
          let readingTimeInterval;
          let webgazerInitialized = false;

          function initializeEyeTracking() {
              if (sessionStorage.getItem('eyeTrackingCalibrated') !== 'true') {
                  alert('Eye tracking not calibrated. Redirecting to calibration...');
                  window.location.href = 'calibration.html';
                  return;
              }

              webgazer.setRegression('ridge')
                  .setTracker('clmtrackr')
                  .setGazeListener(function(data, elapsedTime) {
                      if (data == null || !webgazerInitialized) return;

                      const gazePoint = {
                          x: data.x,
                          y: data.y,
                          timestamp: Date.now(),
                          elapsedTime: elapsedTime,
                          page: 'abstract1'
                      };
                      gazeData.push(gazePoint);
                      showGazeDot(data.x, data.y);
                      checkGazeOnAbstracts(data.x, data.y);
                  })
                  .begin()
                  .then(() => {
                      webgazerInitialized = true;
                      startTime = Date.now();
                      readingTimeInterval = setInterval(updateReadingTimer, 1000);
                      console.log('Eye tracking initialized and active for Abstract 1');
                  }).catch(err => {
                      console.error("WebGazer initialization failed:", err);
                      alert("Could not start eye tracking. Please ensure you have granted camera permissions and are using a compatible browser (like Chrome or Firefox) on a secure (https) connection.");
                  });
          }

          function showGazeDot(x, y) {
              const gazeDot = document.getElementById('gazeDot');
              if(gazeDot){
                gazeDot.style.left = x + 'px';
                gazeDot.style.top = y + 'px';
                gazeDot.style.display = 'block';
              }
          }

          function checkGazeOnAbstracts(x, y) {
              const abstractA = document.getElementById('abstractA');
              const abstractB = document.getElementById('abstractB');
              if (!abstractA || !abstractB) return;

              const rectA = abstractA.getBoundingClientRect();
              const rectB = abstractB.getBoundingClientRect();

              abstractA.classList.remove('tracking');
              abstractB.classList.remove('tracking');

              if (x >= rectA.left && x <= rectA.right && y >= rectA.top && y <= rectA.bottom) {
                  abstractA.classList.add('tracking');
              } else if (x >= rectB.left && x <= rectB.right && y >= rectB.top && y <= rectB.bottom) {
                  abstractB.classList.add('tracking');
              }
          }

          function updateReadingTimer() {
              if (!startTime) return;
              const elapsed = Math.floor((Date.now() - startTime) / 1000);
              const minutes = Math.floor(elapsed / 60);
              const seconds = elapsed % 60;
              document.getElementById('readingTimer').textContent =
                  `Reading Time: ${minutes}:${seconds.toString().padStart(2, '0')}`;
          }

          function handleAbstract1(event) {
              event.preventDefault();

              const formData = new FormData(event.target);
              const data = {};
              for (const pair of formData.entries()) {
                  data[pair[0]] = pair[1];
              }

              data.timestamp = new Date().toISOString();
              data.readingTime = Date.now() - startTime;
              data.gazeDataCount = gazeData.length;

              sessionStorage.setItem('abstract1Data', JSON.stringify(data));
              sessionStorage.setItem('abstract1GazeData', JSON.stringify(gazeData));

              console.log("Abstract 1 data saved. Navigating to Abstract 2.");
              window.location.href = 'abstract2.html';
          }

          window.addEventListener('load', () => {
              initializeEyeTracking();
          });

          window.addEventListener('beforeunload', () => {
              if (readingTimeInterval) {
                  clearInterval(readingTimeInterval);
              }
              if (webgazer && webgazer.isReady()) {
                  webgazer.end();
              }
          });
      </script>
  </body>
  </html>
