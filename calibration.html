 <!DOCTYPE html>
  <html lang="en">
  <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, 
  initial-scale=1.0">
      <title>Eye Tracking Calibration</title>
      <script src="https://webgazer.cs.brown.edu/webgazer.js"></script>
      <style>
          body {
              font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
              max-width: 900px;
              margin: 0 auto;
              padding: 20px;
              line-height: 1.6;
              background-color: #f8f9fa;
              color: #333;
          }
          .calibration-container {
              background-color: white;
              padding: 40px;
              border-radius: 12px;
              box-shadow: 0 4px 20px rgba(0,0,0,0.1);
              text-align: center;
          }
          .header h1 {
              color: #2c3e50;
              margin-bottom: 20px;
          }
          .instructions {
              background-color: #e7f3ff;
              border: 1px solid #b8daff;
              border-radius: 8px;
              padding: 20px;
              margin-bottom: 30px;
              text-align: left;
          }
          .calibration-point {
              width: 20px;
              height: 20px;
              border-radius: 50%;
              background-color: #007bff;
              position: absolute;
              cursor: pointer;
              transition: all 0.3s ease;
              border: 2px solid white;
              box-shadow: 0 2px 8px rgba(0,0,0,0.3);
          }
          .calibration-point:hover {
              transform: scale(1.2);
          }
          .calibration-point.active {
              background-color: #dc3545;
              animation: pulse 1s infinite;
          }
          @keyframes pulse {
              0% { transform: scale(1); }
              50% { transform: scale(1.3); }
              100% { transform: scale(1); }
          }
          .calibration-grid {
              position: relative;
              width: 100%;
              height: 400px;
              border: 2px solid #dee2e6;
              border-radius: 8px;
              margin: 30px 0;
          }
          .status-bar {
              background-color: #f8f9fa;
              padding: 15px;
              border-radius: 8px;
              margin: 20px 0;
          }
          .progress-bar {
              width: 100%;
              height: 10px;
              background-color: #e9ecef;
              border-radius: 5px;
              overflow: hidden;
              margin: 10px 0;
          }
          .progress-fill {
              height: 100%;
              background-color: #007bff;
              width: 0%;
              transition: width 0.3s ease;
          }
          .btn {
              background: linear-gradient(135deg, #007bff, #0056b3);
              color: white;
              padding: 12px 30px;
              border: none;
              border-radius: 8px;
              font-size: 16px;
              font-weight: 600;
              cursor: pointer;
              margin: 10px;
              transition: transform 0.2s, box-shadow 0.2s;
          }
          .btn:hover {
              transform: translateY(-2px);
              box-shadow: 0 6px 20px rgba(0,123,255,0.3);
          }
          .btn:disabled {
              background: #6c757d;
              cursor: not-allowed;
              transform: none;
              box-shadow: none;
          }
          .btn-success {
              background: linear-gradient(135deg, #28a745, #1e7e34);
          }
          .hidden {
              display: none;
          }
          #webgazerVideoFeed {
              position: fixed;
              top: 20px;
              right: 20px;
              width: 200px;
              height: 150px;
              border: 2px solid #007bff;
              border-radius: 8px;
              z-index: 1000;
          }
      </style>
  </head>
  <body>
      <div class="calibration-container">
          <div class="header">
              <h1>üîç Eye Tracking Calibration</h1>
          </div>

          <div class="instructions">
              <h3>Instructions:</h3>
              <ol>
                  <li><strong>Allow camera access</strong> when prompted by
   your browser</li>
                  <li><strong>Position yourself</strong> comfortably in
  front of your screen, about arm's length away</li>
                  <li><strong>Look directly at each blue dot</strong> when
  it appears and click on it</li>
                  <li><strong>Keep your head still</strong> during
  calibration for best results</li>
                  <li><strong>Ensure good lighting</strong> - avoid
  backlighting or shadows on your face</li>
              </ol>
          </div>

          <div class="status-bar">
              <div id="statusMessage">Click "Start Calibration" to
  begin</div>
              <div class="progress-bar">
                  <div class="progress-fill" id="progressFill"></div>
              </div>
              <div id="pointCounter">Points completed: 0/9</div>
          </div>

          <div id="calibrationArea" class="calibration-grid hidden">
          </div>

          <div id="controls">
              <button id="startBtn" class="btn" 
  onclick="startCalibration()">Start Calibration</button>
              <button id="restartBtn" class="btn hidden" 
  onclick="restartCalibration()">Restart Calibration</button>
              <button id="continueBtn" class="btn btn-success hidden" 
  onclick="continueToAbstracts()">Continue to Survey</button>
          </div>
      </div>

      <script>
          let currentPoint = 0;
          let calibrationPoints = [];
          let isCalibrating = false;
          let webgazerReady = false;

          const calibrationPositions = [
              {x: 10, y: 10},   // top-left
              {x: 50, y: 10},   // top-center
              {x: 90, y: 10},   // top-right
              {x: 10, y: 50},   // middle-left
              {x: 50, y: 50},   // center
              {x: 90, y: 50},   // middle-right
              {x: 10, y: 90},   // bottom-left
              {x: 50, y: 90},   // bottom-center
              {x: 90, y: 90}    // bottom-right
          ];

          function initWebGazer() {
              webgazer.setRegression('ridge')
                  .setTracker('clmtrackr')
                  .setGazeListener(function(data, elapsedTime) {
                      if (data == null) return;
                  })
                  .begin()
                  .then(() => {
                      webgazerReady = true;
                      updateStatus("WebGazer initialized. Ready for 
  calibration.");
                  })
                  .catch((err) => {
                      updateStatus("Error initializing WebGazer: " + err);
                  });
          }

          function startCalibration() {
              if (!webgazerReady) {
                  updateStatus("Please wait for WebGazer to 
  initialize...");
                  return;
              }

              isCalibrating = true;
              currentPoint = 0;
              calibrationPoints = [];

              document.getElementById('startBtn').classList.add('hidden');

  document.getElementById('calibrationArea').classList.remove('hidden');

              webgazer.clearData();
              showNextCalibrationPoint();
          }

          function showNextCalibrationPoint() {
              if (currentPoint >= calibrationPositions.length) {
                  completeCalibration();
                  return;
              }

              const area = document.getElementById('calibrationArea');
              area.innerHTML = '';

              const point = document.createElement('div');
              point.className = 'calibration-point active';
              point.style.left = calibrationPositions[currentPoint].x +
  '%';
              point.style.top = calibrationPositions[currentPoint].y + '%';

              point.onclick = function() {
                  collectCalibrationData(this);
              };

              area.appendChild(point);

              updateStatus(`Click on the red dot (${currentPoint + 1}/9)`);
              updateProgress();
          }

          function collectCalibrationData(pointElement) {
              const rect = pointElement.getBoundingClientRect();
              const x = rect.left + rect.width / 2;
              const y = rect.top + rect.height / 2;

              // Collect multiple samples for better accuracy
              let samples = 0;
              const maxSamples = 5;

              const collectSample = () => {
                  samples++;
                  webgazer.recordScreenPosition(x, y);

                  if (samples < maxSamples) {
                      setTimeout(collectSample, 100);
                  } else {
                      currentPoint++;
                      setTimeout(showNextCalibrationPoint, 500);
                  }
              };

              collectSample();
          }

          function completeCalibration() {
              isCalibrating = false;

  document.getElementById('calibrationArea').classList.add('hidden');

  document.getElementById('restartBtn').classList.remove('hidden');

  document.getElementById('continueBtn').classList.remove('hidden');

              updateStatus("Calibration complete! You can now continue to 
  the survey.");
              updateProgress();

              // Store calibration data
              sessionStorage.setItem('eyeTrackingCalibrated', 'true');
              sessionStorage.setItem('calibrationTimestamp', new
  Date().toISOString());
          }

          function restartCalibration() {

  document.getElementById('restartBtn').classList.add('hidden');

  document.getElementById('continueBtn').classList.add('hidden');
              startCalibration();
          }

          function continueToAbstracts() {
              window.location.href = 'abstract1.html';
          }

          function updateStatus(message) {
              document.getElementById('statusMessage').textContent =
  message;
          }

          function updateProgress() {
              const progress = (currentPoint / calibrationPositions.length)
   * 100;
              document.getElementById('progressFill').style.width =
  progress + '%';
              document.getElementById('pointCounter').textContent = `Points
   completed: ${currentPoint}/${calibrationPositions.length}`;
          }

          // Initialize WebGazer when page loads
          window.addEventListener('load', () => {
              updateStatus("Initializing eye tracking system...");
              initWebGazer();
          });

          window.addEventListener('beforeunload', () => {
              if (webgazer) {
                  webgazer.end();
              }
          });
      </script>
  </body>
  </html>



 
